# 复习

- SKU的crud
    - 视图ModelViewSet
    - 序列化器ModelSerializer
- 过滤：重写方法get_queryset()
    - self.request
- 添加时的查询：
    - 第三级分类：subs__isnull=True
    - 标准商品
    - 根据spu_id查询规格及选项self.kwargs
- 添加序列化器create()
    - 1.创建sku对象
    - 2.创建所有规格对象
    - 3.生成静态文件
- 修改序列化器update()

# 反馈

- ***	今天感觉达到了人生巅峰，生活太美好了
- 刘睿	讲的很细

# 今天知识点

- 与fdfs交互
- 图片管理
- 订单管理
- 系统管理

# 与FDFS交互

- 准备工作：
    - 创建新容器tracker、storage
    - 安包python包
- 注意：将client.conf中的base_path、tracker_server
- 通过阅读类的源码可以知道：
    - 上传upload_***()
    - 修改modify_***()
    - 删除delete_file()
- 报错：文件或目录不存在
    - 解决：确定文件没有问题，可能原因是ip发生变化，删除旧容器，创建新容器
- 说明：提供的修改方法有错误
    - 替换方案：先删除，再上传

# 图片管理

- 视图类：ModelViewSet
- 序列化器类：ModelSerializer

### 查询

- 报错：SimpleRouter生成路由规则时，使用[^/.]+匹配主键
- 解决：将具体的正则表达式写在抽象的正则表达式上面

### 增加

- 查询所有sku，用于在下拉列表中选择
    - id
    - name
- 业务逻辑
    - 1.接收图片，上传到fastdfs
    - 2.创建图片对象
- 实现
    - 重写序列化器的create()方法
    - 重写视图的create()方法

### 修改

- 业务逻辑
    - 1.将新图片上传到fdfs
    - 2.修改图片对象

### 删除

- 删除图片
- 删除对象

# 订单管理

### 查询多条、一条

- 查询多条
    - 查询
    - 过滤
    - 分页
- 查询一条
    - 显示完整信息
- 视图类：ReadOnlyModelViewSet
    - ListModelMixin
    - RetrieveModelMixin
- 序列化器类：都可以

### 修改状态

- 修改指定订单对象的状态
- 知识点：在视图集中增加新视图
    - 1.定义方法
    - 2.添加装饰器action
    - 3.请求方式
    - 4.是否接收主键

# 系统管理

### 权限管理方式

- 三种关系
    - 一对一：a=models.OneToOneField()
    - 一对多：b=models.ForeignKey()
    - 多对多：c=models.ManyToManyField()
- from django.contrib.auth.models import Permission,Group,User
- 表：权限
    - 工作内容
    - 数据来源：迁移模型类时由django添加
- 表：组
    - 数据来源：由超级用户添加
- 表：管理员
    - 数据来源：由超级用户（客服经理）添加
- 三个表之间都为多对多关系

### 权限

- 操作：查询多条、增加、查询一条、修改、删除
- 视图类：ModelViewSet
- 序列化类：ModelSerializer

### 组

- 操作：查询多条、增加、查询一条、修改、删除
- 视图类：ModelViewSet
- 序列化类：ModelSerializer
- 模型类序列化器中的create()、update()方法实现的功能
    - 1.创建、修改指定模型类的对象
    - 2.维护多对多的关系

### 管理员

- 操作：查询多条、增加、查询一条、修改、删除
- 视图类：ModelViewSet
- 序列化类：ModelSerializer

# 总结

### 重要知识点

- python与fdfs交互：上传，删除
- 重写视图的方法
- 视图集中增加新方法
    - 1.定义方法
    - 2.装饰器action
- 说明：模型类序列化器中的create()、update()方法维护了多对多关系的数据

### 作业

- 完成今天代码
- 需求：不使用drf，只用django进行前后端分离，如何开发，如何实现jwt的生成与验证

### 大纲要求

- 能够知道fastDFS客户端的使用

```
client=Fdfs_client(配置文件)
client.upload_by_buffer(...)
client.delete_file(...)
```

- 能够改写图片保存和更新的业务逻辑

```
重写视图集的create()、update()方法
1.接收
2.验证
3.处理
    3.1上传文件到fdsf
    3.2创建或修改对象
4.响应
```

- 能够知道更新业务中改写update方法的原因

```
默认只修改对象，而不能上传文件，所以改写
1.删除旧图片
2.上传新图片
3.修改对象
```
